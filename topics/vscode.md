[//]: # (title: Visual Studio Code)

<link-summary>Using Visual Studio Code, you can run %product%, explore %product% reports and connect to Qodana Cloud. </link-summary>

Visual Studio Code is a source code editor available for Windows, macOS and Linux. This section shows you can use 
%product% in Visual Studio Code:

* [Run %product% locally](#vs-code-run-locally) in Visual Studio Code,
* [Connect to Qodana Cloud](#vs-code-connect-to-qodana-cloud),
* [Explore %product% reports](#vs-code-explore-reports) local or downloaded from Qodana Cloud,
* [Configure %product% in Visual Studio Code](#vs-code-configure-extension).

## Before you start

<link-summary>Make sure that you have a project in Qodana Cloud and Java 11 or later is installed on your machine. </link-summary>

Make sure that you have a Qodana Cloud [project](cloud-projects.topic), and this project has at 
least one analysis [report](cloud-overview-reports.topic) related to the project opened by Visual Studio Code. 
Also, check whether Java 11 or later is installed on your machine by running the `java -version` command. If necessary, 
install Java on your local machine.  

Download and install **Qodana** the extension from the 
[Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=JetBrains.qodana-code) website, 
or by navigating to the **Extensions** view in Visual Studio Code.  

## UI overview
{id="vs-code-ui-overview"}

<link-summary>Type "View: Show Qodana" in the command palette of Visual Studio Code to navigate to the Qodana view. </link-summary>

In the command palette, type `View: Show Qodana` and select the **%product%** view.

<img src="vs-code-ui-navigate.png" alt="Navigating to Qodana" width="706" border-effect="line"/>

This will open the **%product%** view in left part of your Visual Studio Code UI.

<img src="vs-code-qodana-view.png" alt="The Qodana view" width="304" border-effect="line"/>

This view contains buttons leading to %product% functionalities in Visual Studio Code. 

Alternatively, in the command palette type `Qodana` to see the list of options present in the **%product%** view.

<img src="vs-code-ui-navigate-alt.png" alt="Navigating to Qodana through a command palette" width="706" border-effect="line"/>

## Run %product% locally
{id="vs-code-run-locally"}

<link-summary>You can run Qodana in Visual Studio Code and then forward inspection reports to Qodana Cloud. </link-summary>

You can run %instance% locally and then forward inspection reports to [Qodana Cloud](cloud-about.topic) for storage and analysis purposes.

> The Docker daemon should be up and running. 
{style="note"}

<procedure>
    <step>
        <p>In Visual Studio Code, navigate to the <a anchor="vs-code-ui-overview"><ui-path>%product%</ui-path></a> view and then click <ui-path>Run Locally</ui-path>.</p>
        <img src="vs-code-local-run.png" alt="Clicking the Run Locally button in the Qodana view" width="304" border-effect="line"/>
    </step>
    <step>
        <p>In the dialog that opens, enter the <a href="project-token.md">project token</a> that was generated by Qodana Cloud.</p>
        <img src="vs-code-local-run-2.png" alt="Specifying the Qodana Cloud project token" width="706" border-effect="line"/>
    </step>
    <step>
        <p>If you have not previously specified a linter in the <a href="qodana-yaml.md"><code>qodana.yaml</code></a> file, 
        choose it in the <ui-path>Select a linter</ui-path> list that opens.</p>
        <img src="vs-code-local-run-3.png" alt="Specifying a linter" width="706" border-effect="line"/>
    </step>
</procedure>

After %product% runs, you can explore analysis results on the [**PROBLEMS**](#vs-code-explore-reports) tab of Visual Studio Code. 

To see the history of local runs of %product% and load analysis reports, in the **%product%** view click the **View History**
button and then choose the report you would like to explore.

To return the **PROBLEMS** tab to the default state, in the **%product%** view click the **Turn Analysis Off** button.

## Connect to Qodana Cloud
{id="vs-code-connect-to-qodana-cloud"}

<link-summary>Connect to Qodana Cloud to forward and get %product% reports in Visual Studio Code. </link-summary>

To forward %product% reports to Qodana Cloud and get the latest %product% reports, log in to Qodana Cloud and connect 
your project opened in the IDE to a specific Qodana Cloud [project](cloud-projects.topic) as shown below.

<procedure>
   <step>
      <p>In Visual Studio Code, navigate to the <a anchor="vs-code-ui-overview"><ui-path>%product%</ui-path></a> view, click the 
      <ui-path>Log in to Cloud</ui-path> button and follow the instructions for redirecting to the authentication page.</p>
      <img src="vs-code-cloud-login-1.png" alt="Logging in to Qodana Cloud" width="304" border-effect="line"/>
   </step>
   <step>
      <p>
         In the <ui-path>%product%</ui-path> view, select a project in Qodana Cloud that you would like to link  
         your local project with, and then click <ui-path>Link</ui-path>. If the project is not present in the list, 
         then click <code>Other project</code> and specify the <a anchor="vscode-config-projectid">project identifier</a> 
         in the dialog that opens.
      </p>
      <img src="vs-code-cloud-login-2.png" alt="Selecting a project for linking" width="304" border-effect="line"/>
   </step>
    <step>
       <p>Navigate to the <ui-path>PROBLEMS</ui-path> tab, or in the <ui-path>%product%</ui-path> view click the 
        <ui-path>Open Report</ui-path> button to explore <a anchor="vs-code-explore-reports">analysis results</a>.</p>
    </step>
</procedure>

## Explore analysis results
{id="vs-code-explore-reports"}

<link-summary>You can explore Qodana reports in Visual Studio Code. </link-summary>

You can explore analysis report of %product% using the **PROBLEMS** tab of Visual Studio Code. 

>If you still do not see the report on the **PROBLEMS** tab, configure the [**Path prefix**](#vs-code-configure-extension) setting.
{style="note"}

On this tab, you can click problem items and navigate to code fragments where %instance% detected them.

<img src="vscode-problems-tab.animated.gif" dark-src="vscode-problems-tab_dark.animated.gif" width="706" alt="The PROBLEMS in VS Code" animated="true" border-effect="line"/>

You can also view analysis reports generated after local %product% runs using the **View History** button in the [%product% view](#vs-code-ui-overview). 

## Configure Qodana
{id="vs-code-configure-extension"}

<link-summary>Learn how you can configure the Path Prefix and Project ID settings in Visual Studio Code. </link-summary>

Here is an overview of the **Qodana** configuration page.

<img src="vscode-settings.png" dark-src="vscode-settings_dark.png" width="706" alt="Qodana settings in VS Code" border-effect="line"/>

You can configure the extension using the following settings:

<table>
    <tr>
        <td>Setting</td>
        <td>Description</td>
    </tr>
    <tr>
        <td>Path Prefix</td>
        <td><p>If necessary, you can override the project path prefix. Here is the rule how the full path to project files is composed:</p>
        <p>Full Path = Workspace + Path Prefix + Path in a <a href="qodana-sarif-output.md">SARIF</a> file</p>
        <p>Here are examples of how to define the correct path prefix:</p>
        <table>
        <tr>
        <td>Full path</td>
        <td>Path in SARIF</td>
        <td>Workspace</td>
        <td>Path prefix</td>
        </tr>
    <tr>
        <td>/foo/bar/baz/file</td>
        <td>baz/file</td>
        <td>/foo/bar</td>
        <td>(empty, no value)</td>
    </tr>
    <tr>
        <td>/foo/bar/baz/file</td>
        <td>baz/file</td>
        <td>/foo/bar/baz</td>
        <td>..</td>
    </tr>
    <tr>
        <td>/foo/bar/baz/file</td>
        <td>file</td>
        <td>/foo/bar</td>
        <td>baz</td>
    </tr>
</table>
<p>In a <a href="ui-overview.md">Qodana Cloud report</a>, you can check with the <ui-path>Files</ui-path> section to 
see how the path in a SARIF file is set.</p>
<p>Feel free to commit the <code>.vscode/settings.json</code> to your repository to share the Qodana settings with your team!</p>
</td>
</tr>
<tr id="vscode-config-projectid">
<td>Project ID</td>
<td>
<p>You can get the Project ID value by opening the project from the 
<a href="ui-overview.md" anchor="ui-overview-actual-problems">Qodana Cloud report</a> using the 
<ui-path>Open file in ...</ui-path> button and choosing Visual Studio Code as the tool for opening. </p>
<p>Alternatively, the Project ID value is contained in your Qodana Cloud project URL. This URL has the following structure: 
<code>https://qodana.cloud/projects/PROJECT_ID/reports/REPORT_ID</code>. From this URL, use only <code>PROJECT_ID</code>.
For example, from the URL <code>https://qodana.cloud/projects/AGvmx/reports/EDKYd</code> you will need <code>AGvmx</code>.</p>
</td>
</tr>
</table>

In the status bar of the Visual Studio Code UI, you can find the **Qodana** icon. This icon can have the following states:

* **Settings are not valid** means that you need to configure the extension. To do it, you can click this icon, which will
  redirect you to the extension configuration page.
* **Not attached to report** means that you have configured the extension, but the report has not been downloaded yet. To
  download the report, click the icon.
* **Attached to report** means that the report was downloaded from Qodana Cloud, and now you can
  [view](#vs-code-explore-reports) it using Visual Studio Code.

## Troubleshooting
{id="vs-code-troubleshooting"}

<link-summary>Use "Qodana: Reset authentication" to switch between Qodana Cloud accounts, and use "Qodana: Reset all settings"
to reset credentials and settings. </link-summary>

### I need to switch to another Qodana Cloud account

You can use the **Qodana: Reset authentication** command to switch between Qodana Cloud accounts without clearing settings. 
This can be useful in case you have several organizations under different Qodana Cloud accounts.

### I cannot get %instance% reports using current settings

You can use the **Qodana: Reset all settings** command to reset all settings and credentials and try to configure 
the extension again, or use other settings.

 